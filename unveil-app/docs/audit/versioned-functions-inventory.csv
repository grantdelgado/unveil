name,layer,file_or_schema,current,version_tag,call_sites,db_dependents,notes,proposed_action,confidence
get_guest_event_messages_v2,DB,public schema,yes,v2,"15+ files: useGuestMessagesRPC.ts, GuestMessaging.tsx, test files","0 policies, 0 triggers","Primary RPC function with union read model, stable ordering, tag filtering, catchup detection. Fixed deduplication logic Jan 30 2025. Optimized with dedicated indexes.",Keep,high
get_guest_event_messages_v1,DB,public schema,no,v1,"0 active callers","0 policies, 0 triggers","Emergency rollback function only. Kept for operational safety but not actively used. Should be removed after v2 proves stable for 6+ months.",Deprecate,high
get_guest_event_messages_legacy,DB,public schema,no,legacy,"0 active callers","0 policies, 0 triggers","Completely superseded by v2. Original implementation from pre-Dec 2024. No references in current codebase.",Remove,high
message_delivery_rollups_v1,DB,public schema,no,v1,"0 active callers","1 RPC function: get_message_rollups","View marked as unused in migration comments. Created for analytics but never adopted. Safe to remove with dependent RPC.",Remove,high
useGuestMessagesRPC,FE,hooks/messaging/useGuestMessagesRPC.ts,yes,current,"8 files: GuestMessaging.tsx, MessageBubble.tsx, test files",N/A,"Current hook implementation. Always calls get_guest_event_messages_v2. Includes realtime subscriptions, pagination, error handling.",Keep,high
fetchOlderMessages,FE,components/features/messaging/,yes,current,"3 files: GuestMessaging.tsx, MessageThread.tsx, pagination components",N/A,"Current pagination implementation. Works with V2 RPC stable ordering. Proper error handling and scroll preservation.",Keep,medium
isFetchingOlder,FE,hooks/messaging/useGuestMessagesRPC.ts,yes,current,"4 files: GuestMessaging.tsx, pagination components",N/A,"Loading state for pagination. Part of current useGuestMessagesRPC implementation. Essential for UX.",Keep,high
handleFetchOlderMessages,FE,components/features/messaging/guest/,yes,current,"2 files: GuestMessaging.tsx, MessageThread.tsx",N/A,"Event handler for pagination with scroll preservation. Enhanced implementation with proper error handling.",Keep,high
delivered_count,DB,messages table,no,legacy,"0 active callers","0 constraints","Legacy analytics field marked as 'currently unused but kept for UI compatibility' in schema comments. May be safe to remove.",Deprecate,medium
failed_count,DB,messages table,no,legacy,"0 active callers","0 constraints","Legacy analytics field marked as 'currently unused but kept for UI compatibility' in schema comments. May be safe to remove.",Deprecate,medium
V2_messaging_patterns,FE,Multiple files,yes,v2,"20+ files: messaging components, hooks, utils",N/A,"Current V2 messaging read-model patterns. Includes stable ordering, union queries, realtime integration. Well-established.",Keep,high
old_test_patterns,FE,__tests__/ directory,no,v1,"3 test files","N/A","Some test files reference old v1 patterns or legacy function names. Tests still pass but should be updated for consistency.",Deprecate,low
